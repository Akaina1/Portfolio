<!-- Generated by SpecStory, Markdown v2.1.0 -->

<!-- cursor Session 59a642c8-5689-43c4-b835-74a6461d8dfd (2025-01-21 15:24Z) -->

# Custom Underline Animation for Header Navigation (2025-01-21 15:24Z)

_**User (2025-01-21 15:30Z)**_

I want to add some custom animations to my header nav items but currently they are being rendered as CMSLink components and applying the buttom type 'link' to each of them.

What I want to do is as follows:

- Add a custom hover animation that animates within the header.  it should be a persistant underline that will move between the hovered menu item.

- example: If a person hovers over the 'Home' link, which is first on the left; moves their mouse down away from the link, the underline wil persist.  if the user then move their mouse to the final link on the right, the underlink will persist on screen and move to the newly hovered menu link.

What is the best way to achieve this? we can add a new button variant if we need to. we must keep the usage of CMSLink as is within the HeaderNav due to the code.  we should also avoid altering CMSLink component in a way that breaks existing functionality.



---

_**Agent**_

I'll help you create this animated navigation effect while maintaining the existing functionality. We'll need to make a few changes to implement this sliding underline animation.

First, let's modify the HeaderNav component to add the animation container and logic:

```typescript:src/Header/Nav/index.tsx
// ... existing code ...

export const HeaderNav: React.FC<{ data: HeaderType }> = ({ data }) => {
  const [activeIndex, setActiveIndex] = useState<number | null>(null);
  const [hoveredIndex, setHoveredIndex] = useState<number | null>(null);
  const navItemRefs = useRef<(HTMLDivElement | null)[]>([]);
  const underlineRef = useRef<HTMLDivElement>(null);
  const navItems = data?.navItems || [];

  // Update underline position
  useEffect(() => {
    const currentIndex = hoveredIndex ?? activeIndex;
    if (currentIndex === null || !underlineRef.current) return;

    const currentElement = navItemRefs.current[currentIndex];
    if (!currentElement) return;

    const { width, left } = currentElement.getBoundingClientRect();
    const parentLeft = currentElement.parentElement?.getBoundingClientRect().left || 0;

    underlineRef.current.style.width = `${width}px`;
    underlineRef.current.style.transform = `translateX(${left - parentLeft}px)`;
  }, [hoveredIndex, activeIndex]);

  // ... existing useEffect and handlers ...

  return (
    <nav className="relative">
      {/* Desktop Navigation */}
      <div className="hidden items-center gap-10 md:flex relative">
        {navItems.map(({ link }, i) => {
          return (
            <div
              key={i}
              ref={(el) => (navItemRefs.current[i] = el)}
              className="relative py-2"
              onMouseEnter={() => setHoveredIndex(i)}
              onMouseLeave={() => setHoveredIndex(null)}
              onClick={() => setActiveIndex(i)}
            >
              <CMSLink {...link} appearance="nav-link" />
            </div>
          );
        })}
        <div
          ref={underlineRef}
          className="absolute bottom-0 h-0.5 bg-primary transition-all duration-300 ease-in-out"
          style={{ width: 0 }}
        />
      </div>

      {/* ... existing mobile menu code ... */}
    </nav>
  );
};
```

Now let's add a new button variant for the navigation links:

```typescript:src/components/ui/button.tsx
const buttonVariants = cva(
  'inline-flex items-center justify-center whitespace-nowrap rounded text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50',
  {
    variants: {
      variant: {
        // ... existing variants ...
        'nav-link': 'text-primary hover:text-primary/80 transition-colors duration-200',
      },
      // ... existing size variants ...
    },
  }
);
```

This implementation:

1. Creates a sliding underline effect that persists and moves between nav items
2. Uses CSS transitions for smooth animations
3. Maintains the current functionality of CMSLink
4. Adds a new `nav-link` variant that can be used specifically for navigation items
5. Tracks both hover and click states to maintain the underline position

The underline will:
- Animate smoothly between items when hovering
- Persist when the mouse leaves the navigation area (using activeIndex)
- Maintain its position until another item is hovered or clicked
- Use your primary color for the underline (customizable via Tailwind)

Key features:
- Uses refs to get precise positioning of nav items
- Calculates exact widths and positions for smooth transitions
- Maintains accessibility and existing link functionality
- Works with the existing CMS structure

The animation is achieved through CSS transforms and transitions, making it performant and smooth. The underline's position is calculated based on the actual DOM elements' positions, ensuring it works correctly regardless of text length or spacing.

---

