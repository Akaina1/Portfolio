<!-- Generated by SpecStory, Markdown v2.1.0 -->

<!-- cursor Session cee881f0-a881-4f62-be00-faa105e0cf39 (2025-01-21 21:08Z) -->

# Maintain Nav Underline on Mouse Exit (2025-01-21 21:08Z)

_**User (2025-01-21 21:08Z)**_

make the underline return to the currently selected nav link when the mouse exits the container

---

_**Agent**_

I'll help modify the code to maintain the underline position at the active nav item when the mouse leaves the container. Here's how we can update the code:

```typescript:src/Header/Nav/index.tsx
// ... existing code ...

  // Update underline position
  useEffect(() => {
    const currentIndex = hoveredIndex !== null ? hoveredIndex : activeIndex;
    if (currentIndex === null || !underlineRef.current) return;

    const currentElement = navItemRefs.current[currentIndex];
    if (!currentElement) return;

    const { width, left } = currentElement.getBoundingClientRect();
    const parentElement = currentElement.parentElement as HTMLElement;
    const parentLeft = parentElement?.getBoundingClientRect().left || 0;

    underlineRef.current.style.width = `${width}px`;
    underlineRef.current.style.transform = `translateX(${left - parentLeft}px)`;
  }, [hoveredIndex, activeIndex]);

  // ... existing code ...

      {/* Desktop Navigation */}
      <div
        ref={navContainerRef}
        className="relative hidden items-center gap-20 md:flex"
        onMouseMove={handleMouseMove}
        onMouseLeave={() => {
          setHoveredIndex(null);
          // If no item is active, reset the underline width to 0
          if (activeIndex === null && underlineRef.current) {
            underlineRef.current.style.width = '0px';
          }
        }}
      >
// ... existing code ...
```

The key changes are:

1. Modified the `useEffect` hook to prioritize the `hoveredIndex` over `activeIndex` using the ternary operator for clearer intent
2. Updated the `onMouseLeave` handler to:
   - Set `hoveredIndex` to null (existing behavior)
   - Reset the underline width to 0 only if there's no active item

Now when you hover away from the nav container:
- If there's an active item, the underline will return to that item's position
- If there's no active item, the underline will disappear

---

_**User (2025-01-21 21:09Z)**_

the default should be the first nav link if none where selected previously

---

_**Agent**_

I'll modify the code to set the first nav item as the default active item when the component mounts:

```typescript:src/Header/Nav/index.tsx
// ... existing code ...

export const HeaderNav: React.FC<{ data: HeaderType }> = ({ data }) => {
  const [isMobileMenuOpen, setIsMobileMenuOpen] = useState(false);
  // Set initial activeIndex to 0 (first item)
  const [activeIndex, setActiveIndex] = useState<number>(0);
  const [hoveredIndex, setHoveredIndex] = useState<number | null>(null);
  
  // ... existing code ...

      <div
        ref={navContainerRef}
        className="relative hidden items-center gap-20 md:flex"
        onMouseMove={handleMouseMove}
        onMouseLeave={() => {
          setHoveredIndex(null);
          // Remove condition since we'll always have an active index
          if (underlineRef.current) {
            const currentElement = navItemRefs.current[activeIndex];
            if (!currentElement) return;

            const { width, left } = currentElement.getBoundingClientRect();
            const parentElement = currentElement.parentElement as HTMLElement;
            const parentLeft = parentElement?.getBoundingClientRect().left || 0;

            underlineRef.current.style.width = `${width}px`;
            underlineRef.current.style.transform = `translateX(${left - parentLeft}px)`;
          }
        }}
      >
// ... existing code ...
```

Key changes:
1. Changed the `activeIndex` state to initialize with `0` instead of `null`
2. Updated the `onMouseLeave` handler to always reposition the underline to the active item's position
3. Removed the condition that would reset the underline width to 0 since we'll always have an active item

Now the first nav item will be selected by default, and the underline will always return to the active item when the mouse leaves the container.

---

